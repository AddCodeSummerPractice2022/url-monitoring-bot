from email import message
from aiogram.dispatcher import FSMContext
from aiogram.dispatcher.filters.state import State, StatesGroup
from aiogram import types, Dispatcher
from createBot import dp


class FSMNotify(StatesGroup):
    freq = State()
    site = State()
    answer = State()

async def cm_start(message : types.Message):
    await FSMNotify.freq.set()
    await message.reply('Введите частоту вывода уведомлений (Месяц, Неделя, День, Час)')

async def cancel_handler(message: types.Message, state: FSMContext):
        if message.text.strip() == "отмена" or "Отмена":
            current_state = await state.get_state()
            if current_state is None:
                await message.answer('Вам нечего отменять =)')
                await message.delete()
                return
            await state.finish()
            await message.reply('Вы вернулись в главное меню')

async def set_freq(message: types.Message, state: FSMNotify):
    if (message.text == "Месяц"):
        async with state.proxy() as data:
            data['freq'] = message.text
        await message.answer('Вы установили частату вывода уведомлений: Месяц')
        await message.answer('Введите адрес сайта, для которого хотите получать уведомления')
        await FSMNotify.next()
    elif(message.text == "Неделя"):
        async with state.proxy() as data:
            data['freq'] = message.text
        await message.answer('Вы установили частату вывода уведомлений: Неделя')
        await message.answer('Введите адрес сайта, для которого хотите получать уведомления')
        await FSMNotify.next()
    elif(message.text == "День"):
        async with state.proxy() as data:
            data['freq'] = message.text
        await message.answer('Вы установили частату вывода уведомлений: День')
        await message.answer('Введите адрес сайта, для которого хотите получать уведомления')
        await FSMNotify.next()
    elif(message.text == "Час"):
        async with state.proxy() as data:
            data['freq'] = message.text
        await message.answer('Вы установили частату вывода уведомлений: Час')
        await message.answer('Введите адрес сайта, для которого хотите получать уведомления')
        await FSMNotify.next()
    else:
        await message.reply("Вы ввели неверную частоту (Пример: Месяц/Неделя/День/Час)")  

async def set_url(message: types.Message, state: FSMNotify):
    
